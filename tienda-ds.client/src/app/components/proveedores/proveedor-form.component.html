<div class="form-container" style="max-width: 800px;">
  <h2>{{ isEditMode ? 'Editar Proveedor' : 'Nuevo Proveedor' }}</h2>

  <div *ngIf="error" class="error">{{ error }}</div>

  <form [formGroup]="proveedorForm" (ngSubmit)="onSubmit()">
    <div class="form-group">
      <label for="Empresa">Empresa *</label>
      <input type="text" id="Empresa" formControlName="Empresa" class="form-control"
        [class.invalid]="proveedorForm.get('Empresa')?.invalid && proveedorForm.get('Empresa')?.touched" />
      <div class="error-message" *ngIf="proveedorForm.get('Empresa')?.invalid && proveedorForm.get('Empresa')?.touched">
        <span *ngIf="proveedorForm.get('Empresa')?.errors?.['required']">El nombre de la empresa es requerido</span>
        <span *ngIf="proveedorForm.get('Empresa')?.errors?.['minlength']">Debe tener al menos 3 caracteres</span>
      </div>
    </div>

    <div class="form-group">
      <label for="Contacto">Contacto</label>
      <input type="text" id="Contacto" formControlName="Contacto" class="form-control" />
    </div>

    <div class="form-group">
      <label for="IdUsuario">Usuario asociado (rol proveedor)</label>
      <select id="IdUsuario" formControlName="IdUsuario" class="form-control">
        <option value="">Sin usuario asociado</option>
        <option *ngFor="let usuario of usuarios" [value]="usuario.IdUsuario">
          {{ usuario.NombreUsuario }}
        </option>
      </select>
      <small>Opcional</small>
    </div>

    <!-- SecciÃ³n de Productos -->
    <div *ngIf="!isEditMode" class="productos-section">
      <h3>ðŸ“¦ Productos que suministra</h3>
      <p class="hint">Agregue los productos que este proveedor le suministra</p>

      <div formArrayName="productos">
        <div *ngFor="let prod of productosArray.controls; let i = index" [formGroupName]="i" class="producto-row">
          <div class="producto-fields">
            <div class="form-group">
              <label>Nombre *</label>
              <input type="text" formControlName="NombreProd" class="form-control" placeholder="Nombre del producto" />
            </div>
            <div class="form-group">
              <label>P. Compra *</label>
              <input type="number" formControlName="PrecioCompra" class="form-control" step="0.01" placeholder="0.00" />
            </div>
            <div class="form-group">
              <label>P. Venta *</label>
              <input type="number" formControlName="PrecioVenta" class="form-control" step="0.01" placeholder="0.00" />
            </div>
            <div class="form-group">
              <label>Stock</label>
              <input type="number" formControlName="Stock" class="form-control" placeholder="0" />
            </div>
            <button type="button" class="btn-delete btn-remove" (click)="removeProducto(i)" *ngIf="productosArray.length > 1">âœ•</button>
          </div>
        </div>
      </div>

      <button type="button" class="btn-primary btn-add" (click)="addProducto()">+ Agregar producto</button>
    </div>

    <div class="form-actions">
      <button type="submit" class="btn btn-primary" [disabled]="loading">
        {{ loading ? 'Guardando...' : (isEditMode ? 'Actualizar' : 'Crear Proveedor y Productos') }}
      </button>
      <button type="button" class="btn btn-secondary" (click)="onCancel()">
        Cancelar
      </button>
    </div>
  </form>
</div>
